const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-Bq1SgGO7.js","assets/vendor-DEQFvjV0.js"])))=>i.map(i=>d[i]);
import{r as _s,a as ws,R as G,u as Re,b as D,c as y,g as Bt,d as bs,N as M,O as vs,L as Ee,e as xs,f as js,B as ks,h as Ss,i as $}from"./vendor-DEQFvjV0.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var Le={exports:{}},oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ot;function Cs(){if(ot)return oe;ot=1;var r=_s(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,n=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function a(o,c,l){var d,h={},f=null,m=null;l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),c.ref!==void 0&&(m=c.ref);for(d in c)s.call(c,d)&&!i.hasOwnProperty(d)&&(h[d]=c[d]);if(o&&o.defaultProps)for(d in c=o.defaultProps,c)h[d]===void 0&&(h[d]=c[d]);return{$$typeof:e,type:o,key:f,ref:m,props:h,_owner:n.current}}return oe.Fragment=t,oe.jsx=a,oe.jsxs=a,oe}var ct;function Ps(){return ct||(ct=1,Le.exports=Cs()),Le.exports}var u=Ps(),xe={},lt;function Es(){if(lt)return xe;lt=1;var r=ws();return xe.createRoot=r.createRoot,xe.hydrateRoot=r.hydrateRoot,xe}var Ts=Es(),Mt={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ut=G.createContext&&G.createContext(Mt),Os=["attr","size","title"];function Ns(r,e){if(r==null)return{};var t=Rs(r,e),s,n;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);for(n=0;n<i.length;n++)s=i[n],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(r,s)&&(t[s]=r[s])}return t}function Rs(r,e){if(r==null)return{};var t={};for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){if(e.indexOf(s)>=0)continue;t[s]=r[s]}return t}function Te(){return Te=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Te.apply(this,arguments)}function dt(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,s)}return t}function Oe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dt(Object(t),!0).forEach(function(s){$s(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):dt(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function $s(r,e,t){return e=As(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function As(r){var e=Is(r,"string");return typeof e=="symbol"?e:e+""}function Is(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function zt(r){return r&&r.map((e,t)=>G.createElement(e.tag,Oe({key:t},e.attr),zt(e.child)))}function J(r){return e=>G.createElement(Ls,Te({attr:Oe({},r.attr)},e),zt(r.child))}function Ls(r){var e=t=>{var{attr:s,size:n,title:i}=r,a=Ns(r,Os),o=n||t.size||"1em",c;return t.className&&(c=t.className),r.className&&(c=(c?c+" ":"")+r.className),G.createElement("svg",Te({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,a,{className:c,style:Oe(Oe({color:r.color||t.color},t.style),r.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),i&&G.createElement("title",null,i),r.children)};return ut!==void 0?G.createElement(ut.Consumer,null,t=>e(t)):e(Mt)}function Us(r){return J({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"},child:[]}]})(r)}function Jt(r){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(r)}function Ht(r){return J({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528.12 301.319l47.273-208C578.806 78.301 567.391 64 551.99 64H159.208l-9.166-44.81C147.758 8.021 137.93 0 126.529 0H24C10.745 0 0 10.745 0 24v16c0 13.255 10.745 24 24 24h69.883l70.248 343.435C147.325 417.1 136 435.222 136 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-15.674-6.447-29.835-16.824-40h209.647C430.447 426.165 424 440.326 424 456c0 30.928 25.072 56 56 56s56-25.072 56-56c0-22.172-12.888-41.332-31.579-50.405l5.517-24.276c3.413-15.018-8.002-29.319-23.403-29.319H218.117l-6.545-32h293.145c11.206 0 20.92-7.754 23.403-18.681z"},child:[]}]})(r)}function Ds(r){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(r)}function Fs(r){return J({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(r)}function qs(r){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M370.72 133.28C339.458 104.008 298.888 87.962 255.848 88c-77.458.068-144.328 53.178-162.791 126.85-1.344 5.363-6.122 9.15-11.651 9.15H24.103c-7.498 0-13.194-6.807-11.807-14.176C33.933 94.924 134.813 8 256 8c66.448 0 126.791 26.136 171.315 68.685L463.03 40.97C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.749zM32 296h134.059c21.382 0 32.09 25.851 16.971 40.971l-41.75 41.75c31.262 29.273 71.835 45.319 114.876 45.28 77.418-.07 144.315-53.144 162.787-126.849 1.344-5.363 6.122-9.15 11.651-9.15h57.304c7.498 0 13.194 6.807 11.807 14.176C478.067 417.076 377.187 504 256 504c-66.448 0-126.791-26.136-171.315-68.685L48.97 471.03C33.851 486.149 8 475.441 8 454.059V320c0-13.255 10.745-24 24-24z"},child:[]}]})(r)}function ht(r){return J({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}function Bs(r){return J({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"},child:[]}]})(r)}const Ms=()=>{const r=Re(),e=D(),[t,s]=y.useState("");y.useEffect(()=>{const o=new URLSearchParams(r.search);s(o.get("search")||"")},[r.search]);const n=o=>{const c=o.target.value;s(c),e(`/?search=${encodeURIComponent(c)}`)},i=()=>{t.trim()!==""&&(e(`/?search=${encodeURIComponent(t)}`),s(""))},a=o=>{o.key==="Enter"&&i()};return u.jsxs("div",{className:"flex items-center border border-gray-300 bg-gray-100 rounded-md px-2 py-0.2 w-full",children:[u.jsx("input",{type:"text",placeholder:"Caută produse...",className:"w-full border-none outline-none px-2 text-sm h-8 bg-gray-100",value:t,onChange:n,onKeyDown:a}),u.jsx("button",{className:"bg-sky-900 text-white px-3 py-1 rounded-md text-sm h-7 transform transition duration-250 hover:bg-sky-800 active:scale-105 active:bg-sky-700 hidden sm:block",onClick:i,children:"Caută"}),u.jsx("button",{className:"text-sky-900 p-2 rounded-full sm:hidden",onClick:i,children:u.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 19l-4-4M9 14a5 5 0 110-10 5 5 0 010 10z"})})})]})};var Ue={exports:{}},De,ft;function zs(){if(ft)return De;ft=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return De=r,De}var Fe,mt;function Js(){if(mt)return Fe;mt=1;var r=zs();function e(){}function t(){}return t.resetWarningCache=e,Fe=function(){function s(a,o,c,l,d,h){if(h!==r){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}s.isRequired=s;function n(){return s}var i={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:t,resetWarningCache:e};return i.PropTypes=i,i},Fe}var gt;function Hs(){return gt||(gt=1,Ue.exports=Js()()),Ue.exports}var Vs=Hs();const E=Bt(Vs),Ws="modulepreload",Gs=function(r){return"/dan-store/"+r},pt={},se=function(e,t,s){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(t.map(c=>{if(c=Gs(c),c in pt)return;pt[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":Ws,l||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),l)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},Ks=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>se(async()=>{const{default:s}=await Promise.resolve().then(()=>ne);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Ze extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Qs extends Ze{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Ys extends Ze{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Xs extends Ze{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var He;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(He||(He={}));var Zs=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class er{constructor(e,{headers:t={},customFetch:s,region:n=He.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Ks(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Zs(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const d=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:l}).catch(g=>{throw new Qs(g)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new Ys(d);if(!d.ok)throw new Xs(d);let f=((s=d.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return f==="application/json"?m=yield d.json():f==="application/octet-stream"?m=yield d.blob():f==="text/event-stream"?m=d:f==="multipart/form-data"?m=yield d.formData():m=yield d.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}var O={},ce={},le={},ue={},de={},he={},tr=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},re=tr();const sr=re.fetch,Vt=re.fetch.bind(re),Wt=re.Headers,rr=re.Request,nr=re.Response,ne=Object.freeze(Object.defineProperty({__proto__:null,Headers:Wt,Request:rr,Response:nr,default:Vt,fetch:sr},Symbol.toStringTag,{value:"Module"})),ir=bs(ne);var je={},yt;function Gt(){if(yt)return je;yt=1,Object.defineProperty(je,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return je.default=r,je}var _t;function Kt(){if(_t)return he;_t=1;var r=he.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(he,"__esModule",{value:!0});const e=r(ir),t=r(Gt());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=Object.assign({},this.headers),this.headers[i]=a,this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var d,h,f;let m=null,g=null,_=null,p=l.status,w=l.statusText;if(l.ok){if(this.method!=="HEAD"){const j=await l.text();j===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?g=j:g=JSON.parse(j))}const x=(d=this.headers.Prefer)===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),S=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");x&&S&&S.length>1&&(_=parseInt(S[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(m={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,_=null,p=406,w="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const x=await l.text();try{m=JSON.parse(x),Array.isArray(m)&&l.status===404&&(g=[],m=null,p=200,w="OK")}catch{l.status===404&&x===""?(p=204,w="No Content"):m={message:x}}if(m&&this.isMaybeSingle&&(!((f=m==null?void 0:m.details)===null||f===void 0)&&f.includes("0 rows"))&&(m=null,p=200,w="OK"),m&&this.shouldThrowOnError)throw new t.default(m)}return{error:m,data:g,count:_,status:p,statusText:w}});return this.shouldThrowOnError||(c=c.catch(l=>{var d,h,f;return{error:{message:`${(d=l==null?void 0:l.name)!==null&&d!==void 0?d:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(f=l==null?void 0:l.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}}return he.default=s,he}var wt;function Qt(){if(wt)return de;wt=1;var r=de.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(de,"__esModule",{value:!0});const e=r(Kt());class t extends e.default{select(n){let i=!1;const a=(n??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",d=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${d?`${d},`:""}${n}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(l,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var d;const h=[n?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${f}"; options=${h};`,l==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return de.default=t,de}var bt;function et(){if(bt)return ue;bt=1;var r=ue.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ue,"__esModule",{value:!0});const e=r(Qt());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${a})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(n,`${c}fts${l}.${i}`),this}match(n){return Object.entries(n).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(n,i,a){return this.url.searchParams.append(n,`not.${i}.${a}`),this}or(n,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,i,a){return this.url.searchParams.append(n,`${i}.${a}`),this}}return ue.default=t,ue}var vt;function Yt(){if(vt)return le;vt=1;var r=le.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(le,"__esModule",{value:!0});const e=r(et());class t{constructor(n,{headers:i={},schema:a,fetch:o}){this.url=n,this.headers=i,this.schema=a,this.fetch=o}select(n,{head:i=!1,count:a}={}){const o=i?"HEAD":"GET";let c=!1;const l=(n??"*").split("").map(d=>/\s/.test(d)&&!c?"":(d==='"'&&(c=!c),d)).join("");return this.url.searchParams.set("select",l),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const l=n.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(l.length>0){const d=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const l="POST",d=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&d.push(this.headers.Prefer),o&&d.push(`count=${o}`),c||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(n)){const h=n.reduce((f,m)=>f.concat(Object.keys(m)),[]);if(h.length>0){const f=[...new Set(h)].map(m=>`"${m}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",a=[];return n&&a.push(`count=${n}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return le.default=t,le}var fe={},me={},xt;function ar(){return xt||(xt=1,Object.defineProperty(me,"__esModule",{value:!0}),me.version=void 0,me.version="0.0.0-automated"),me}var jt;function or(){if(jt)return fe;jt=1,Object.defineProperty(fe,"__esModule",{value:!0}),fe.DEFAULT_HEADERS=void 0;const r=ar();return fe.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},fe}var kt;function cr(){if(kt)return ce;kt=1;var r=ce.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ce,"__esModule",{value:!0});const e=r(Yt()),t=r(et()),s=or();class n{constructor(a,{headers:o={},schema:c,fetch:l}={}){this.url=a,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=l}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new n(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:l=!1,count:d}={}){let h;const f=new URL(`${this.url}/rpc/${a}`);let m;c||l?(h=c?"HEAD":"GET",Object.entries(o).filter(([_,p])=>p!==void 0).map(([_,p])=>[_,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([_,p])=>{f.searchParams.append(_,p)})):(h="POST",m=o);const g=Object.assign({},this.headers);return d&&(g.Prefer=`count=${d}`),new t.default({method:h,url:f,headers:g,schema:this.schemaName,body:m,fetch:this.fetch,allowEmpty:!1})}}return ce.default=n,ce}var St;function lr(){if(St)return O;St=1;var r=O.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(O,"__esModule",{value:!0}),O.PostgrestError=O.PostgrestBuilder=O.PostgrestTransformBuilder=O.PostgrestFilterBuilder=O.PostgrestQueryBuilder=O.PostgrestClient=void 0;const e=r(cr());O.PostgrestClient=e.default;const t=r(Yt());O.PostgrestQueryBuilder=t.default;const s=r(et());O.PostgrestFilterBuilder=s.default;const n=r(Qt());O.PostgrestTransformBuilder=n.default;const i=r(Kt());O.PostgrestBuilder=i.default;const a=r(Gt());return O.PostgrestError=a.default,O.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:a.default},O}var ur=lr();const dr=Bt(ur),{PostgrestClient:hr,PostgrestQueryBuilder:fi,PostgrestFilterBuilder:mi,PostgrestTransformBuilder:gi,PostgrestBuilder:pi,PostgrestError:yi}=dr,fr="2.11.2",mr={"X-Client-Info":`realtime-js/${fr}`},gr="1.0.0",Xt=1e4,pr=1e3;var te;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(te||(te={}));var A;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(A||(A={}));var I;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(I||(I={}));var Ve;(function(r){r.websocket="websocket"})(Ve||(Ve={}));var W;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(W||(W={}));class yr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Zt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var C;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(C||(C={}));const Ct=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=_r(a,r,e,n),i),{})},_r=(r,e,t,s)=>{const n=e.find(o=>o.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?es(i,a):We(a)},es=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return xr(e,t)}switch(r){case C.bool:return wr(e);case C.float4:case C.float8:case C.int2:case C.int4:case C.int8:case C.numeric:case C.oid:return br(e);case C.json:case C.jsonb:return vr(e);case C.timestamp:return jr(e);case C.abstime:case C.date:case C.daterange:case C.int4range:case C.int8range:case C.money:case C.reltime:case C.text:case C.time:case C.timestamptz:case C.timetz:case C.tsrange:case C.tstzrange:return We(e);default:return We(e)}},We=r=>r,wr=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},br=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},vr=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},xr=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>es(e,o))}return r},jr=r=>typeof r=="string"?r.replace(" ","T"):r,ts=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class qe{constructor(e,t,s={},n=Xt){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Pt;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Pt||(Pt={}));class ye{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ye.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=ye.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ye.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,d)=>{a[l]||(c[l]=d)}),this.map(a,(l,d)=>{const h=i[l];if(h){const f=d.map(p=>p.presence_ref),m=h.map(p=>p.presence_ref),g=d.filter(p=>m.indexOf(p.presence_ref)<0),_=h.filter(p=>f.indexOf(p.presence_ref)<0);g.length>0&&(o[l]=g),_.length>0&&(c[l]=_)}else o[l]=d}),this.syncDiff(i,{joins:o,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var l;const d=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),d.length>0){const h=e[o].map(m=>m.presence_ref),f=d.filter(m=>h.indexOf(m.presence_ref)<0);e[o].unshift(...f)}s(o,d,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const d=c.map(h=>h.presence_ref);l=l.filter(h=>d.indexOf(h.presence_ref)<0),e[o]=l,n(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Et;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Et||(Et={}));var Tt;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Tt||(Tt={}));var U;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(U||(U={}));class tt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=A.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new qe(this,I.join,this.params,this.timeout),this.rejoinTimer=new Zt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=A.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=A.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this._on(I.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new ye(this),this.broadcastEndpointURL=ts(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(d=>e==null?void 0:e(U.CHANNEL_ERROR,d)),this._onClose(()=>e==null?void 0:e(U.CLOSED));const c={},l={broadcast:i,presence:a,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var h;if(this.socket.setAuth(),d===void 0){e==null||e(U.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,m=(h=f==null?void 0:f.length)!==null&&h!==void 0?h:0,g=[];for(let _=0;_<m;_++){const p=f[_],{filter:{event:w,schema:k,table:x,filter:S}}=p,j=d&&d[_];if(j&&j.event===w&&j.schema===k&&j.table===x&&j.filter===S)g.push(Object.assign(Object.assign({},p),{id:j.id}));else{this.unsubscribe(),e==null||e(U.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(U.SUBSCRIBED);return}}).receive("error",d=>{e==null||e(U.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(U.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=l.body)===null||n===void 0?void 0:n.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=A.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(I.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new qe(this,I.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new qe(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:d}=I;if(s&&[o,c,l,d].indexOf(a)>=0&&s!==this._joinRef())return;let f=this._onMessage(a,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,_,p;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((p=(_=m.filter)===null||_===void 0?void 0:_.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===a}).map(m=>m.callback(f,s)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var g,_,p,w,k,x;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const S=m.id,j=(g=m.filter)===null||g===void 0?void 0:g.event;return S&&((_=t.ids)===null||_===void 0?void 0:_.includes(S))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const S=(k=(w=m==null?void 0:m.filter)===null||w===void 0?void 0:w.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return S==="*"||S===((x=t==null?void 0:t.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:_,table:p,commit_timestamp:w,type:k,errors:x}=g;f=Object.assign(Object.assign({},{schema:_,table:p,commit_timestamp:w,eventType:k,new:{},old:{},errors:x}),this._getPayloadRecords(g))}m.callback(f,s)})}_isClosed(){return this.state===A.closed}_isJoined(){return this.state===A.joined}_isJoining(){return this.state===A.joining}_isLeaving(){return this.state===A.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&tt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(I.close,{},e)}_onError(e){this._on(I.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=A.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ct(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ct(e.columns,e.old_record)),t}}const kr=()=>{},Sr=typeof WebSocket<"u",Cr=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Pr{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=mr,this.params={},this.timeout=Xt,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=kr,this.conn=null,this.sendBuffer=[],this.serializer=new yr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>se(async()=>{const{default:c}=await Promise.resolve().then(()=>ne);return{default:c}},void 0).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Ve.websocket}`,this.httpEndpoint=ts(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Zt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Sr){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new Er(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),se(async()=>{const{default:e}=await import("./browser-Bq1SgGO7.js").then(t=>t.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:gr}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case te.connecting:return W.Connecting;case te.open:return W.Open;case te.closing:return W.Closing;default:return W.Closed}}isConnected(){return this.connectionState()===W.Open}channel(e,t={config:{}}){const s=new tt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(I.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(pr,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(I.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Cr],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Er{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=te.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class st extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function T(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Tr extends st{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ge extends st{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Or=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const ss=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>se(async()=>{const{default:s}=await Promise.resolve().then(()=>ne);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Nr=()=>Or(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield se(()=>Promise.resolve().then(()=>ne),void 0)).Response:Response}),Ke=r=>{if(Array.isArray(r))return r.map(t=>Ke(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Ke(s)}),e};var K=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Be=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Rr=(r,e,t)=>K(void 0,void 0,void 0,function*(){const s=yield Nr();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new Tr(Be(n),r.status||500))}).catch(n=>{e(new Ge(Be(n),n))}):e(new Ge(Be(r),r))}),$r=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function be(r,e,t,s,n,i){return K(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,$r(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Rr(c,o,s))})})}function Ne(r,e,t,s){return K(this,void 0,void 0,function*(){return be(r,"GET",e,t,s)})}function B(r,e,t,s,n){return K(this,void 0,void 0,function*(){return be(r,"POST",e,s,n,t)})}function Ar(r,e,t,s,n){return K(this,void 0,void 0,function*(){return be(r,"PUT",e,s,n,t)})}function Ir(r,e,t,s){return K(this,void 0,void 0,function*(){return be(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function rs(r,e,t,s,n){return K(this,void 0,void 0,function*(){return be(r,"DELETE",e,s,n,t)})}var R=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Lr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ot={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ur{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=ss(n)}uploadOrUpdate(e,t,s,n){return R(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Ot),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),f=yield h.json();return h.ok?{data:{path:l,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(T(i))return{data:null,error:i};throw i}})}upload(e,t,s){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return R(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Ot.upsert},n),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,d["cache-control"]=`max-age=${l.cacheControl}`,d["content-type"]=l.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:d}),f=yield h.json();return h.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(c){if(T(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return R(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield B(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new st("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}})}update(e,t,s){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return R(this,void 0,void 0,function*(){try{return{data:yield B(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}copy(e,t,s){return R(this,void 0,void 0,function*(){try{return{data:{path:(yield B(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return R(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield B(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return R(this,void 0,void 0,function*(){try{const n=yield B(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}download(e,t){return R(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield Ne(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(T(o))return{data:null,error:o};throw o}})}info(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield Ne(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ke(s),error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}})}exists(e){return R(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ir(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(T(s)&&s instanceof Ge){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return R(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}list(e,t,s){return R(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Lr),t),{prefix:e||""});return{data:yield B(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Dr="2.7.1",Fr={"X-Client-Info":`storage-js/${Dr}`};var X=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class qr{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Fr),t),this.fetch=ss(s)}listBuckets(){return X(this,void 0,void 0,function*(){try{return{data:yield Ne(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}getBucket(e){return X(this,void 0,void 0,function*(){try{return{data:yield Ne(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return X(this,void 0,void 0,function*(){try{return{data:yield B(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return X(this,void 0,void 0,function*(){try{return{data:yield Ar(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}})}emptyBucket(e){return X(this,void 0,void 0,function*(){try{return{data:yield B(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}deleteBucket(e){return X(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}}class Br extends qr{constructor(e,t={},s){super(e,t,s)}from(e){return new Ur(this.url,this.headers,e,this.fetch)}}const Mr="2.48.1";let pe="";typeof Deno<"u"?pe="deno":typeof document<"u"?pe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?pe="react-native":pe="node";const zr={"X-Client-Info":`supabase-js-${pe}/${Mr}`},Jr={headers:zr},Hr={schema:"public"},Vr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Wr={};var Gr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Kr=r=>{let e;return r?e=r:typeof fetch>"u"?e=Vt:e=fetch,(...t)=>e(...t)},Qr=()=>typeof Headers>"u"?Wt:Headers,Yr=(r,e,t)=>{const s=Kr(t),n=Qr();return(i,a)=>Gr(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:r;let l=new n(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:l}))})};var Xr=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};function Zr(r){return r.replace(/\/$/,"")}function en(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:a,auth:o,realtime:c,global:l}=e,d={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>Xr(this,void 0,void 0,function*(){return""})};return r.accessToken?d.accessToken=r.accessToken:delete d.accessToken,d}const ns="2.67.3",tn="http://localhost:9999",sn="supabase.auth.token",rn={"X-Client-Info":`gotrue-js/${ns}`},Nt=10,Qe="X-Supabase-Api-Version",is={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function nn(r){return Math.round(Date.now()/1e3)+r}function an(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const L=()=>typeof window<"u"&&typeof document<"u",H={tested:!1,writable:!1},_e=()=>{if(!L())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(H.tested)return H.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),H.tested=!0,H.writable=!0}catch{H.tested=!0,H.writable=!1}return H.writable};function on(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const as=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>se(async()=>{const{default:s}=await Promise.resolve().then(()=>ne);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},cn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",os=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ke=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Se=async(r,e)=>{await r.removeItem(e)};function ln(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,n,i,a,o,c,l,d=0;for(r=r.replace("-","+").replace("_","/");d<r.length;)a=e.indexOf(r.charAt(d++)),o=e.indexOf(r.charAt(d++)),c=e.indexOf(r.charAt(d++)),l=e.indexOf(r.charAt(d++)),s=a<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&n!=0&&(t=t+String.fromCharCode(n)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class $e{constructor(){this.promise=new $e.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}$e.promiseConstructor=Promise;function Rt(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(ln(s))}async function un(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function dn(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function hn(r){return("0"+r.toString(16)).substr(-2)}function fn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,hn).join("")}async function mn(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function gn(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pn(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await mn(r);return gn(t)}async function Z(r,e,t=!1){const s=fn();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await os(r,`${e}-code-verifier`,n);const i=await pn(s);return[i,s===i?"plain":"s256"]}const yn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function _n(r){const e=r.headers.get(Qe);if(!e||!e.match(yn))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class rt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function b(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class wn extends rt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function bn(r){return b(r)&&r.name==="AuthApiError"}class cs extends rt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Q extends rt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class F extends Q{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function vn(r){return b(r)&&r.name==="AuthSessionMissingError"}class Me extends Q{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ce extends Q{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Pe extends Q{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xn(r){return b(r)&&r.name==="AuthImplicitGrantRedirectError"}class $t extends Q{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ye extends Q{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ze(r){return b(r)&&r.name==="AuthRetryableFetchError"}class At extends Q{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var jn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const V=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),kn=[502,503,504];async function It(r){var e;if(!cn(r))throw new Ye(V(r),0);if(kn.includes(r.status))throw new Ye(V(r),r.status);let t;try{t=await r.json()}catch(i){throw new cs(V(i),i)}let s;const n=_n(r);if(n&&n.getTime()>=is["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new At(V(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new F}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new At(V(t),r.status,t.weak_password.reasons);throw new wn(V(t),r.status||500,s)}const Sn=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function v(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Qe]||(i[Qe]=is["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await Cn(r,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function Cn(r,e,t,s,n,i){const a=Sn(e,s,n,i);let o;try{o=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new Ye(V(c),0)}if(o.ok||await It(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await It(c)}}function q(r){var e;let t=null;On(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=nn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function Lt(r){const e=q(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function z(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Pn(r){return{data:r,error:null}}function En(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=jn(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Tn(r){return r}function On(r){return r.access_token&&r.refresh_token&&r.expires_in}var Nn=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Rn{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=as(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await v(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await v(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:z})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Nn(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await v(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:En,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(b(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await v(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:z})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},d=await v(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Tn});if(d.error)throw d.error;const h=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(c=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(g=>{const _=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(g.split(";")[1].split("=")[1]);l[`${p}Page`]=_}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(b(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await v(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:z})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await v(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:z})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await v(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:z})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await v(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(b(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await v(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}}const $n={getItem:r=>_e()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{_e()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{_e()&&globalThis.localStorage.removeItem(r)}};function Ut(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function An(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ee={debug:!!(globalThis&&_e()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ls extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class In extends ls{}async function Ln(r,e,t){ee.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),ee.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){ee.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{ee.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw ee.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new In(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(ee.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}An();const Un={url:tn,storageKey:sn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},ge=30*1e3,Dt=3;async function Ft(r,e,t){return await t()}class we{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=we.nextInstanceID,we.nextInstanceID+=1,this.instanceID>0&&L()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Un),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Rn({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=as(n.fetch),this.lock=n.lock||Ft,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:L()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ln:this.lock=Ft,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:_e()?this.storage=$n:(this.memoryStorage={},this.storage=Ut(this.memoryStorage)):(this.memoryStorage={},this.storage=Ut(this.memoryStorage)),L()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ns}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=on(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),L()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),xn(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return b(t)?{error:t}:{error:new cs("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:q}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:d,password:h,options:f}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await Z(this.storage,this.storageKey)),i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:d,password:h,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:g},xform:q})}else if("phone"in e){const{phone:d,password:h,options:f}=e;i=await v(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(n=f==null?void 0:f.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:q})}else throw new Ce("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Lt})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await v(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Lt})}else throw new Ce("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Me}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await ke(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await v(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:q});if(await Se(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Me}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(b(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,o=await v(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:q}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Me}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,d=null;this.flowType==="pkce"&&([l,d]=await Z(this.storage,this.storageKey));const{error:h}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:d}=await v(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:d}}throw new Ce("You must provide either an email or phone number.")}catch(o){if(b(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await v(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:q});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(b(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await Z(this.storage,this.storageKey)),await v(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Pn})}catch(i){if(b(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new F;const{error:n}=await v(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(b(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await v(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:o}=await v(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Ce("You must provide either an email or phone number and a type")}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ke(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,d)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,d))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:z}):await this._useSession(async t=>{var s,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new F}:await v(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:z})})}catch(t){if(b(t))return vn(t)&&(await this._removeSession(),await Se(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new F;const a=n.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Z(this.storage,this.storageKey));const{data:l,error:d}=await v(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:z});if(d)throw d;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return Rt(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new F;const t=Date.now()/1e3;let s=t,n=!0,i=null;const a=Rt(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(b(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new F;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!L())throw new Pe("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Pe(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new $t("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Pe("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $t("No code detected.");const{data:k,error:x}=await this._exchangeCodeForSession(e.code);if(x)throw x;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!i||!o||!a||!l)throw new Pe("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(o);let f=d+h;c&&(f=parseInt(c));const m=f-d;m*1e3<=ge&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const g=f-h;d-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,d):d-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,d);const{data:_,error:p}=await this._getUser(i);if(p)throw p;const w={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:f,refresh_token:a,token_type:l,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:w,redirectType:e.type},error:null}}catch(s){if(b(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ke(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(bn(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Se(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=an(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Z(this.storage,this.storageKey,!0));try{return await v(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(b(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,o,c,l,d;const{data:h,error:f}=i;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await v(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&d!==void 0?d:void 0})});if(n)throw n;return L()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(b(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await v(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await dn(async n=>(n>0&&await un(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await v(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:q})),(n,i)=>{const a=200*Math.pow(2,n);return i&&ze(i)&&Date.now()+a-s<ge})}catch(s){if(this._debug(t,"error",s),b(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),L()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await ke(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+Nt;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Nt}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),ze(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new F;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new $e;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new F;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),b(i)){const a={session:null,error:i};return ze(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await os(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Se(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&L()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ge);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/ge);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${ge}ms, refresh threshold is ${Dt} ticks`),n<=Dt&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ls)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!L()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await Z(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await v(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await v(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(n.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}we.nextInstanceID=0;const Dn=we;class Fn extends Dn{constructor(e){super(e)}}var qn=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(s.next(d))}catch(h){a(h)}}function c(d){try{l(s.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):n(d.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Bn{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Zr(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:Hr,realtime:Wr,auth:Object.assign(Object.assign({},Vr),{storageKey:c}),global:Jr},d=en(s??{},l);this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=d.auth)!==null&&a!==void 0?a:{},this.headers,d.global.fetch),this.fetch=Yr(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new hr(`${o}/rest/v1`,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new er(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Br(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return qn(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:o,debug:c},l,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Fn({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:o,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Pr(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Mn=(r,e,t)=>new Bn(r,e,t),zn="https://cxoacgsfbpiwggyaolqk.supabase.co",Jn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4b2FjZ3NmYnBpd2dneWFvbHFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1MzI4NTAsImV4cCI6MjA1NTEwODg1MH0.dWwiqSgn95gLsO8INo_jWhXzu_OoXlhJGBzk1dLGuxw",P=Mn(zn,Jn),N=[];for(let r=0;r<256;++r)N.push((r+256).toString(16).slice(1));function Hn(r,e=0){return(N[r[e+0]]+N[r[e+1]]+N[r[e+2]]+N[r[e+3]]+"-"+N[r[e+4]]+N[r[e+5]]+"-"+N[r[e+6]]+N[r[e+7]]+"-"+N[r[e+8]]+N[r[e+9]]+"-"+N[r[e+10]]+N[r[e+11]]+N[r[e+12]]+N[r[e+13]]+N[r[e+14]]+N[r[e+15]]).toLowerCase()}let Je;const Vn=new Uint8Array(16);function Wn(){if(!Je){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Je=crypto.getRandomValues.bind(crypto)}return Je(Vn)}const Gn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),qt={randomUUID:Gn};function Kn(r,e,t){var n;if(qt.randomUUID&&!r)return qt.randomUUID();r=r||{};const s=r.random??((n=r.rng)==null?void 0:n.call(r))??Wn();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,Hn(s)}const Ae=y.createContext(),us=({children:r})=>{const[e,t]=y.useState([]),[s,n]=y.useState(null);y.useEffect(()=>{(async()=>{const{data:d,error:h}=await P.auth.getSession();if(h||!d.session){n(null);return}const{data:f,error:m}=await P.auth.getUser();m||(f!=null&&f.user&&f.user.aud==="authenticated"?n(f.user.id):n(null))})();const{data:l}=P.auth.onAuthStateChange((d,h)=>{d==="SIGNED_IN"?n(h.user.id):d==="SIGNED_OUT"&&(n(null),t([]))});return()=>{l.subscription.unsubscribe()}},[]),y.useEffect(()=>{(async()=>{if(!s){const l=JSON.parse(localStorage.getItem("favoriteItems"))||[];t(l);return}try{const{data:l,error:d}=await P.from("favorites").select(`
            product_id,
            products (
              id,
              title,
              price,
              images
            )
          `).eq("user_id",s);if(d)return;t(l.map(h=>({product_id:h.product_id,title:h.products.title,price:h.products.price,images:h.products.images})))}catch(l){console.error("Eroare la încărcarea produselor favorite:",l)}})()},[s]);const i=async c=>{let l=c.id;if(o(l)||(l=Kn()),!e.some(d=>d.product_id===l)){if(s)try{const{error:d}=await P.from("favorites").insert([{user_id:s,product_id:l}]);if(d)throw d}catch(d){console.error("Eroare la adăugarea în favorite:",d);return}else{const d=JSON.parse(localStorage.getItem("favoriteItems"))||[];d.push({product_id:l,title:c.title,price:c.price,images:c.images}),localStorage.setItem("favoriteItems",JSON.stringify(d))}t(d=>[...d,{product_id:l,title:c.title,price:c.price,images:c.images}])}},a=async c=>{if(t(l=>l.filter(d=>d.product_id!==c)),s)try{const{error:l}=await P.from("favorites").delete().eq("user_id",s).eq("product_id",c);l&&console.error("Eroare la eliminarea din favorite:",l)}catch(l){console.error("Eroare la eliminarea din favorite:",l)}else{const d=(JSON.parse(localStorage.getItem("favoriteItems"))||[]).filter(h=>h.product_id!==c);localStorage.setItem("favoriteItems",JSON.stringify(d))}},o=c=>/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(c);return u.jsx(Ae.Provider,{value:{favoriteItems:e,addToFavorites:i,removeFromFavorites:a},children:r})};us.propTypes={children:E.node.isRequired};const ve=y.createContext(),ds=({children:r})=>{const[e,t]=y.useState([]);y.useEffect(()=>{(async()=>{var p;const{data:d,error:h}=await P.auth.getSession();if(h){console.error("Error fetching user:",h);return}const f=(p=d==null?void 0:d.session)==null?void 0:p.user;if(!f){const w=JSON.parse(localStorage.getItem("cartItems"))||[];t(w);return}const m=f.id,{data:g,error:_}=await P.from("cart").select("id, quantity, product_id, product_price, products (title, images, description)").eq("user_id",m);_?console.error("Error fetching cart items:",_):t(g||[])})()},[]);const s=async(l,d=1)=>{var _;const{data:h,error:f}=await P.auth.getSession();if(f){console.error("Error fetching user:",f);return}const m=(_=h==null?void 0:h.session)==null?void 0:_.user;if(!m){const p=JSON.parse(localStorage.getItem("cartItems"))||[],w=p.find(k=>k.product_id===l.id);w?(w.quantity+=d,w.product_price=w.quantity*l.price):p.push({product_id:l.id,product_price:d*l.price,quantity:d,products:{title:l.title,images:l.images,description:l.description}}),localStorage.setItem("cartItems",JSON.stringify(p)),t(p);return}const g=e.find(p=>p.product_id===l.id);if(g){t(w=>w.map(k=>k.product_id===l.id?{...k,quantity:k.quantity+d,product_price:(k.quantity+d)*l.price}:k));const{error:p}=await P.from("cart").update({quantity:g.quantity+d}).eq("id",g.id);p&&console.error("Error updating cart item:",p)}else{const p={product_id:l.id,product_price:d*l.price,quantity:d,products:{title:l.title,images:l.images,description:l.description}};t(x=>[...x,p]);const{data:w,error:k}=await P.from("cart").insert([{user_id:m.id,product_id:l.id,quantity:d,product_price:l.price}]).select("id");k?console.error("Error adding item to cart:",k):w&&w.length>0&&t(x=>x.map(S=>S.product_id===l.id?{...S,id:w[0].id}:S))}},n=async l=>{var g;const{data:d,error:h}=await P.auth.getSession();if(h){console.error("Error fetching user:",h);return}const f=(g=d==null?void 0:d.session)==null?void 0:g.user;if(!f){const p=(JSON.parse(localStorage.getItem("cartItems"))||[]).filter(w=>w.product_id!==l);localStorage.setItem("cartItems",JSON.stringify(p)),t(p);return}const{error:m}=await P.from("cart").delete().eq("user_id",f.id).eq("product_id",l);m?console.error("Error removing item from cart:",m):t(_=>_.filter(p=>p.product_id!==l))},i=async(l,d)=>{var _;const{data:h,error:f}=await P.auth.getSession();if(f){console.error("Error fetching user:",f);return}const m=(_=h==null?void 0:h.session)==null?void 0:_.user;if(!m){const p=JSON.parse(localStorage.getItem("cartItems"))||[],w=p.find(k=>k.product_id===l);w&&(w.quantity=d,localStorage.setItem("cartItems",JSON.stringify(p)),t(p));return}const{error:g}=await P.from("cart").update({quantity:d}).eq("user_id",m.id).eq("product_id",l);g?console.error("Error updating quantity:",g):t(p=>p.map(w=>w.product_id===l?{...w,quantity:d}:w))},a=l=>{const d=e.find(h=>h.product_id===l);return d?d.quantity:0},o=l=>e.some(d=>d.product_id===l),c=l=>{const d=JSON.parse(localStorage.getItem("cartItems"))||[],h=d.findIndex(f=>f.product_id===l);h!==-1&&(d[h].quantity=1,localStorage.setItem("cartItems",JSON.stringify(d)))};return u.jsx(ve.Provider,{value:{cartItems:e,addToCart:s,removeFromCart:n,updateQuantity:i,getQuantity:a,isInCart:o,resetQuantity:c},children:r})};ds.propTypes={children:E.node.isRequired};const ie=y.createContext(),hs=({children:r})=>{const[e,t]=y.useState(!1),[s,n]=y.useState(!1),[i,a]=y.useState(null);y.useEffect(()=>{(async()=>{const{data:d,error:h}=await P.auth.getSession();if(h||!d.session){t(!1),a(null);return}const{data:f,error:m}=await P.auth.getUser();if(m){t(!1),a(null);return}f!=null&&f.user&&f.user.aud==="authenticated"?(t(!0),a(f.user)):(t(!1),a(null))})()},[]);const o=l=>{t(!0),a(l)},c=async()=>{await P.auth.signOut(),t(!1),a(null)};return u.jsx(ie.Provider,{value:{isAuthenticated:e,user:i,login:o,logout:c,showLogoutMessage:s,setShowLogoutMessage:n},children:r})};hs.propTypes={children:E.node.isRequired};const Qn="/dan-store/assets/logo-ZtOW4sF0.png",Yn=()=>{const{logout:r,setShowLogoutMessage:e}=y.useContext(ie),t=D(),s=()=>{r(),e(!0),setTimeout(()=>{e(!1),t("/")},3e3)};return u.jsxs("button",{onClick:s,className:"flex items-center space-x-1 hover:text-gray-800 text-sm",children:[u.jsx(Ds,{className:"w-4 h-4"}),u.jsx("span",{className:"hidden lg:inline text-xs",children:"Log Out"})]})},fs=({onSearch:r})=>{const{favoriteItems:e}=y.useContext(Ae),{cartItems:t}=y.useContext(ve),{isAuthenticated:s,user:n,showLogoutMessage:i}=y.useContext(ie);return u.jsxs("header",{className:"w-full bg-gray-100 border-b",children:[u.jsx("div",{className:"w-full bg-stone-800 text-center text-white py-0.5 text-[9px] font-semibold",children:u.jsx("p",{children:"Livrare gratuită pentru comenzile peste 300 RON!"})}),u.jsxs("div",{className:`flex justify-between items-center px-6 py-2 bg-white ${i?"blur-sm":""}`,children:[u.jsx(M,{to:"/",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("img",{src:Qn,alt:"DanStore Logo",className:"h-8 sm:h-9 mr-2"}),u.jsxs("div",{className:"text-base font-semibold text-gray-800",children:[u.jsx("span",{className:"text-lg sm:text-2xl font-bold text-green-500",children:"Dan"}),u.jsx("span",{className:"text-lg sm:text-2xl font-bold text-green-700",children:"Store"})]})]})}),u.jsx("div",{className:"flex-1 flex justify-center ml-2 sm:ml-4 pr-2 sm:pr-7",children:u.jsx("div",{className:"w-full max-w-3xl ml-2 sm:ml-5",children:u.jsx(Ms,{onSearch:r})})}),u.jsxs("div",{className:"flex items-center space-x-4 text-gray-600",children:[s&&u.jsxs("span",{className:"text-sm text-sky-600 hidden md:block",children:["Salut, ",n.email,"!"]}),s?u.jsxs(u.Fragment,{children:[u.jsx(Yn,{})," ",u.jsx(M,{to:"/myaccount",children:u.jsxs("button",{className:"flex items-center space-x-1 hover:text-gray-800 text-sm",children:[u.jsx(ht,{className:"w-4 h-4"}),u.jsx("span",{className:"hidden lg:inline text-xs",children:"Contul Meu"})]})})]}):u.jsx(M,{to:"/login",children:u.jsxs("button",{className:"flex items-center space-x-1 hover:text-gray-800 text-sm",children:[u.jsx(ht,{className:"w-4 h-4"}),u.jsx("span",{className:"hidden lg:inline text-xs",children:"Log In"})]})}),u.jsxs(M,{to:"/favorite",className:"relative flex items-center space-x-1 hover:text-gray-800 text-sm",children:[u.jsxs("div",{className:"relative",children:[u.jsx(Jt,{className:"w-4 h-4"}),e.length>0&&u.jsx("span",{className:`absolute -top-1 -right-1 bg-red-600\r
                 text-white text-[10px] font-bold w-3.5 h-3.5 flex items-center \r
                 justify-center rounded-full`,children:e.length})]}),u.jsx("span",{className:"hidden lg:inline text-xs",children:"Favorite"})]}),u.jsxs(M,{to:"/cart",className:"relative flex items-center space-x-1 hover:text-gray-800 text-sm",children:[u.jsxs("div",{className:"relative",children:[u.jsx(Ht,{className:"w-4 h-4"}),t.length>0&&u.jsx("span",{className:`absolute -top-1 -right-1 bg-red-600\r
                 text-white text-[10px] font-bold w-3.5 h-3.5 flex items-center \r
                 justify-center rounded-full`,children:t.length})]}),u.jsx("span",{className:"hidden lg:inline text-xs",children:"Coș"})]})]})]}),i&&u.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",children:u.jsx("div",{className:"bg-blue-200 p-20 rounded-lg shadow-lg text-center max-w-sm mx-auto",children:u.jsx("h2",{className:"text-3xl font-bold mb-2",children:"La revedere!"})})})]})};fs.propTypes={onSearch:E.func.isRequired};const ms=({toggleSidebar:r})=>u.jsx("div",{className:"w-full bg-white py-1 shadow-md",children:u.jsxs("div",{className:"flex justify-between items-center px-4",children:[u.jsx("button",{className:"text-gray-600 hover:text-gray-800 md:hidden",onClick:r,children:u.jsx(Us,{className:"w-6 h-6"})}),u.jsxs("div",{className:"flex-1 flex justify-center space-x-12",children:[" ",u.jsx(M,{to:"/",className:({isActive:e})=>e?"text-blue-500 hover:text-blue-700 text-sm":"text-gray-600 hover:text-gray-800 text-sm",children:"Acasa"}),u.jsx(M,{to:"/NewProducts",className:({isActive:e})=>e?"text-blue-500 hover:text-blue-700 text-sm":"text-gray-600 hover:text-gray-800 text-sm",children:"Produse Noi"}),u.jsx(M,{to:"/Promotions",className:({isActive:e})=>e?"text-blue-500 hover:text-blue-700 text-sm":"text-gray-600 hover:text-gray-800 text-sm",children:"Promotii"})]})]})});ms.propTypes={toggleSidebar:E.func.isRequired};const gs=({isSidebarOpen:r,toggleSidebar:e})=>{const t=D(),[s,n]=y.useState(""),[i,a]=y.useState([1,1200]),[o,c]=y.useState(0),l=g=>{s===g?(n(""),f("",i,o)):(n(g),f(g,i,o))},d=g=>{const _=g.target.value.split(",").map(Number);a(_),f(s,_,o)},h=g=>{const _=parseInt(g.target.value,10);c(_),f(s,i,_)},f=(g,_,p)=>{t(`/product-list?gender=${g}&minPrice=${_[0]}&maxPrice=${_[1]}&rating=${p}`)},m=g=>{g.target===g.currentTarget&&e()};return u.jsxs(u.Fragment,{children:[r&&u.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden",onClick:m}),u.jsx("nav",{className:`fixed md:static inset-y-0 left-0 bg-stone-800 text-white 
        p-4 transition-transform duration-300 
      ease-in-out z-30 top-[6.5rem] bottom-[4.5rem] w-64 md:w-1/4 lg:w-1/5 xl:w-1/6 ${r?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:u.jsxs("div",{className:"relative z-10 h-full",children:[u.jsx("button",{className:"absolute top-4 right-4 md:hidden",onClick:e,children:"✕"}),u.jsxs("ul",{className:"space-y-2",children:[u.jsxs("li",{children:[u.jsx("p",{className:"text-gray-500 font-bold py-2",children:"Filtre:"}),u.jsx("div",{className:"block py-2 px-3 text-gray-500 rounded",children:"Categorie:"}),u.jsxs("ul",{className:"pl-4 space-y-2",children:[u.jsx("li",{children:u.jsx("button",{className:`block py-2 px-3 text-white hover:scale-105 hover:bg-gray-900 active:scale-110 rounded ${s==="masculin"?"bg-gray-900":""}`,onClick:()=>l("masculin"),children:"Barbati"})}),u.jsx("li",{children:u.jsx("button",{className:`block py-2 px-3 text-white hover:scale-105 hover:bg-gray-900 active:scale-110 rounded ${s==="feminin"?"bg-gray-900":""}`,onClick:()=>l("feminin"),children:"Femei"})})]})]}),u.jsxs("li",{className:"block py-2 px-3 text-white",children:[u.jsx("label",{htmlFor:"priceRange",children:"Preț:"}),u.jsx("input",{type:"range",id:"priceRange",name:"priceRange",min:"1",max:"1200",value:i,onChange:d,className:"w-full",multiple:!0}),u.jsxs("div",{className:"flex justify-between text-xs",children:[u.jsxs("span",{children:[i[0]," RON"]}),u.jsxs("span",{children:[i[1]," RON"]})]})]}),u.jsxs("li",{className:"block py-2 px-3 text-white",children:[u.jsx("label",{htmlFor:"rating1",children:"Rating:"}),u.jsx("div",{id:"rating",className:"flex flex-wrap space-x-1",children:[1,2,3,4,5].map(g=>u.jsxs("label",{htmlFor:`rating${g}`,children:[u.jsx("input",{type:"radio",id:`rating${g}`,name:"rating",value:g,checked:o===g,onChange:h,className:"hidden"}),u.jsx(Fs,{className:`w-6 h-6 cursor-pointer ${o>=g?"text-yellow-500":"text-gray-400"}`})]},g))})]})]})]})})]})};gs.propTypes={isSidebarOpen:E.bool.isRequired,toggleSidebar:E.func.isRequired};const Xn=()=>u.jsxs("footer",{className:"flex w-full text-center text-white font-semibold bg-black mb-4 p-4 mt-8 justify-center items-center",children:[" ",u.jsx("p",{children:"© 2025 Dan Store. All rights reserved."})]}),Zn=()=>{const[r,e]=y.useState(!1),t=()=>e(!r),[s,n]=y.useState(""),i=D(),a=Re();y.useEffect(()=>{a.pathname==="/"&&n("")},[a.pathname]);const o=l=>{n(l),i("/")},c=()=>{n(""),i("/")};return u.jsxs("div",{className:"flex flex-col h-screen overflow-auto",children:[u.jsx(fs,{onSearch:o}),u.jsx(ms,{toggleSidebar:t,onHomeClick:c}),u.jsxs("div",{className:"flex flex-1 overflow-auto",children:[u.jsx(gs,{isSidebarOpen:r,toggleSidebar:t}),u.jsx("div",{className:"flex-1 p-4 sm:p-5 overflow-auto",children:u.jsx(vs,{context:{searchTerm:s,setSearchTerm:n}})})]}),u.jsx(Xn,{})]})},Ie=({product:r,showText:e=!0})=>{const{favoriteItems:t,addToFavorites:s,removeFromFavorites:n}=y.useContext(Ae),[i,a]=y.useState(!1);y.useEffect(()=>{a(t.some(c=>c.product_id===r.id))},[t,r.id]);const o=()=>{i?(n(r.id),a(!1)):(s(r),a(!0))};return u.jsxs("button",{onClick:o,className:`flex items-center space-x-2 transition-colors duration-100 transform hover:scale-105 active:scale-110 ${i?"text-sky-800":"text-gray-400"}`,children:[i?u.jsx(Jt,{className:"w-6 h-6"}):u.jsx(Bs,{className:"w-6 h-6"}),e&&u.jsx("span",{children:i?"Remove from Favorites":"Add to Favorites"})]})};Ie.propTypes={product:E.object.isRequired,showText:E.bool};const nt=({product:r,quantity:e=1,setQuantity:t,showText:s=!0})=>{const{isInCart:n,addToCart:i,removeFromCart:a,resetQuantity:o}=y.useContext(ve),c=n(r.id),l=()=>{c?(a(r.id),o(r.id),t(1)):(i(r,e),t(1))};return u.jsxs("button",{onClick:l,className:`flex items-center space-x-3 transition-colors duration-200 transform hover:scale-105 active:scale-110 ${c?"text-sky-900":"text-gray-400"}`,children:[u.jsx(Ht,{className:"cursor-pointer w-6 h-6 hover:text-sky-700 active:text-sky-800 transform active:scale-105 hidden sm:block"}),s&&u.jsx("span",{children:c?"Remove from Cart":"Add to Cart"})]})};nt.propTypes={product:E.object.isRequired,quantity:E.number,setQuantity:E.func.isRequired,showText:E.bool};const it=({searchTerm:r})=>{const[e,t]=y.useState([]),[s,n]=y.useState({}),i=Re(),a=new URLSearchParams(i.search),o=a.get("gender"),c=parseInt(a.get("minPrice"),10)||1,l=parseInt(a.get("maxPrice"),10)||2e3;y.useEffect(()=>{(async()=>{const{data:m,error:g}=await P.from("products").select("*");if(g){console.error("Eroare la încărcarea produselor:",g);return}t(m)})()},[]);const d=(f,m)=>{n(g=>({...g,[f]:m}))},h=e.filter(f=>{const m=r?f.title.toLowerCase().includes(r.toLowerCase())||f.description.toLowerCase().includes(r.toLowerCase()):!0,g=o?f.gender===o:!0,_=f.price>=c&&f.price<=l;return m&&g&&_});return u.jsx("div",{className:"flex justify-center",children:u.jsx("div",{className:"w-full max-w-7xl p-2",children:u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-5",children:h.length>0?h.map(f=>u.jsxs("div",{className:`relative w-full aspect-w-1 aspect-h-1 border rounded-md p-4 \r
                shadow hover:shadow-lg transition-transform duration-200 flex flex-col \r
                items-center justify-between bg-gray-100 hover:scale-105`,children:[u.jsxs(Ee,{to:`/product/${f.id}`,className:"w-full h-full flex flex-col items-center justify-between",children:[u.jsx("div",{className:"w-full h-full flex justify-center items-center",children:u.jsx("img",{src:f.images[0],alt:f.title,className:"w-full h-full object-cover rounded-md"})}),u.jsx("h3",{className:"text-lg font-semibold mt-2 text-center",children:f.title}),u.jsx("p",{className:"text-sm text-gray-600 mt-1 text-center",children:f.description}),u.jsxs("p",{className:"text-base font-bold mt-2 text-center",children:[f.price," RON"]})]}),u.jsxs("div",{className:"absolute bottom-2 right-2 flex space-x-2 items-center sm:bottom-2 sm:right-2",children:[u.jsx("div",{className:"mt-1 sm:mt-1 sm:ml-2 sm:static",children:u.jsx(Ie,{product:f,showText:!1})}),u.jsx("div",{className:"hidden 2xl:block",children:u.jsx(nt,{product:f,quantity:s[f.id]||1,setQuantity:m=>d(f.id,m),showText:!1})})]})]},f.id)):u.jsx("p",{className:"text-center col-span-full",children:"Niciun produs găsit."})})})})};it.propTypes={searchTerm:E.string};const ei=()=>{const r=Re(),t=new URLSearchParams(r.search).get("search")||"";return u.jsx("div",{children:u.jsx(it,{searchTerm:t})})},ti=()=>u.jsx("div",{className:"flex items-center justify-center h-screen",children:u.jsx("p",{className:"text-center text-xl mt-[-20%]",children:"Ne pare rău, avem numai vechituri"})}),ps=y.createContext(),ys=({children:r})=>{const[e,t]=y.useState({}),s=(n,i)=>{t(a=>({...a,[n]:i}))};return u.jsx(ps.Provider,{value:{quantities:e,updateQuantity:s},children:r})};ys.propTypes={children:E.node.isRequired};const at=({id:r,initialQuantity:e=1,onQuantityChange:t})=>{const{quantities:s,updateQuantity:n}=y.useContext(ps),[i,a]=y.useState(s[r]||e),[o,c]=y.useState(!1);y.useEffect(()=>{s[r]!==void 0&&a(s[r])},[s,r]);const l=d=>{const h=Number(d.target.value);h>=1&&h<=100&&(a(h),n(r,h),t(r,h),c(!0),setTimeout(()=>{c(!1)},1e3))};return u.jsxs("div",{className:"flex items-center",children:[u.jsx("label",{htmlFor:`quantity-select-${r}`,className:"text-sm text-gray-700 mr-2",children:"Cantitate:"}),u.jsx("select",{id:`quantity-select-${r}`,name:`quantity-${r}`,value:i,onChange:l,className:"w-14 p-2 border rounded-md bg-gray-100",children:Array.from({length:100},(d,h)=>h+1).map(d=>u.jsx("option",{value:d,children:d},d))}),o&&u.jsx(qs,{className:"ml-2 text-blue-500 animate-spin"})]})};at.propTypes={id:E.oneOfType([E.string,E.number]).isRequired,initialQuantity:E.number,onQuantityChange:E.func.isRequired};const si=()=>{const{cartItems:r,removeFromCart:e,updateQuantity:t,resetQuantity:s}=y.useContext(ve),[n,i]=y.useState({});y.useEffect(()=>{const l={};r.forEach(d=>{l[d.product_id]=d.quantity}),i(l)},[r]);const a=(l,d)=>{i(h=>({...h,[l]:d})),t(l,d)},o=l=>{e(l),s(l)},c=()=>r.reduce((l,d)=>l+d.product_price*(n[d.product_id]||d.quantity),0);return r.length===0?u.jsx("h1",{className:"text-center mt-8",children:"Coșul tău este gol."}):u.jsx("div",{className:"container mx-auto p-3",children:u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-5",children:u.jsxs("div",{className:"w-full sm:max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md col-span-full",children:[u.jsx("h1",{className:"text-xl sm:text-3xl font-bold mb-3",children:"Coșul tău de cumpărături"}),u.jsx("hr",{className:"border-t-2 border-gray-200 mb-8"}),u.jsx("div",{className:"space-y-4",children:r.map((l,d)=>{var h,f,m,g;return u.jsxs("div",{children:[u.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between",children:[u.jsx(Ee,{to:`/product/${l.product_id}`,children:u.jsxs("div",{className:"flex items-start mb-4 sm:mb-0",children:[u.jsx("img",{src:(h=l.products)!=null&&h.images?l.products.images[0]:"",alt:((f=l.products)==null?void 0:f.title)||"Product Image",className:"w-20 h-20 sm:w-24 sm:h-24 object-contain mr-4 transition-transform duration-200 hover:scale-105 active:scale-110"}),u.jsxs("div",{className:"flex flex-col",children:[u.jsx("h2",{className:"text-lg font-bold",children:((m=l.products)==null?void 0:m.title)||"Product Title"}),u.jsx("p",{className:"text-sm text-gray-700",children:((g=l.products)==null?void 0:g.description)||"Product Description"})]})]})}),u.jsxs("div",{className:"flex items-center justify-between w-full sm:w-auto space-x-4",children:[u.jsxs("p",{className:"text-gray-700 font-semibold",children:[l.product_price*(n[l.product_id]||l.quantity)," ","RON"]}),u.jsx(at,{id:l.product_id,initialQuantity:n[l.product_id]||l.quantity,onQuantityChange:a}),u.jsx("button",{className:"bg-red-600 text-white px-2 py-2 rounded-md transform transition duration-250 hover:bg-red-700 active:scale-105 active:bg-red-800 w-24 sm:w-auto",onClick:()=>o(l.product_id),children:"Șterge"})]})]}),d<r.length-1&&u.jsx("hr",{className:"my-4 border-t border-gray-200"})]},`${l.id}-${l.product_id}`)})}),u.jsx("div",{className:"mt-6 text-right",children:u.jsxs("h2",{className:"text-xl font-bold",children:["Preț Total: ",c()," RON"]})}),u.jsxs("div",{className:"flex flex-col sm:flex-row justify-between mt-6",children:[u.jsx(Ee,{to:"/",className:"bg-sky-900 text-white px-3 py-2 rounded-md transform transition duration-250 hover:bg-sky-800 active:scale-105 active:bg-sky-700 w-full sm:w-auto mb-4 sm:mb-0 text-center",children:"Înapoi la cumpărături"}),u.jsx("button",{className:"bg-sky-900 text-white px-3 py-2 rounded-md transform transition duration-250 hover:bg-sky-800 active:scale-105 active:bg-sky-700 w-full sm:w-auto",children:"Comandă"})]})]})})})},ri=()=>u.jsx("div",{className:"flex items-center justify-center h-screen",children:u.jsx("p",{className:"text-center text-xl mt-[-20%]",children:"Ciuciu!"})}),ni=()=>u.jsx("h1",{children:"404 - Page Not Found"}),ii=()=>{const{id:r}=xs(),e=D(),[t,s]=y.useState(null),[n,i]=y.useState(1),[a,o]=y.useState(0),{cartItems:c,addToCart:l,removeFromCart:d,updateQuantity:h,getQuantity:f}=y.useContext(ve),m=c.some(x=>x.product_id===r);if(y.useEffect(()=>{(async()=>{if(!r){console.error("ID-ul produsului nu este definit:",r);return}const{data:S,error:j}=await P.from("products").select("*").eq("id",r).single();if(j){console.error("Eroare la încărcarea produsului:",j);return}s(S),i(f(r))})()},[r,f]),!t)return u.jsx("h1",{className:"text-center mt-8",children:"Produsul nu a fost găsit."});const g=()=>{e(-1)},_=(x,S)=>{i(S),h(x,S)},p=()=>{m?(d(t.id),i(1)):(l(t,n),i(1))},w=()=>{o(x=>x===0?t.images.length-1:x-1)},k=()=>{o(x=>x===t.images.length-1?0:x+1)};return u.jsxs("div",{className:"max-w-full mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-md relative",children:[u.jsx("button",{className:"absolute top-4 right-4 text-gray-600 hover:text-gray-900",onClick:g,children:"✕"}),u.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-8 overflow-y-auto",children:[u.jsxs("div",{className:"lg:w-2/3 relative",children:[u.jsx("button",{className:"absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-l",onClick:w,children:"<"}),u.jsx("div",{className:"w-full h-64 sm:h-96 md:h-[500px] lg:h-[550px] bg-gray-50 flex items-center justify-center rounded-md",children:u.jsx("img",{src:t.images[a],alt:t.title,className:"h-[85%] md:h-[90%] lg:h-[95%] w-auto object-contain"})}),u.jsx("button",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-r",onClick:k,children:">"}),u.jsx("p",{className:"text-gray-700 mt-4",children:t.description})]}),u.jsxs("div",{className:"w-full lg:w-1/3 lg:pl-8 flex flex-col justify-center",children:[u.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mt-4 lg:mt-0",children:t.title}),u.jsxs("p",{className:"text-xl sm:text-2xl font-bold text-sky-700 mt-4",children:[t.price," RON"]}),u.jsx("div",{className:"mt-4",children:u.jsx(at,{id:t.id,initialQuantity:n,onQuantityChange:_})}),u.jsx("button",{className:`${m?"bg-red-600 hover:bg-red-700 active:bg-red-800":"bg-sky-900 hover:bg-sky-800 active:bg-sky-700"} text-white px-3 py-2 rounded-md transform transition duration-250 active:scale-105 mt-4`,style:{width:"65%"},onClick:p,children:m?"Șterge din coș":"Adaugă în coș"}),u.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Livrare gratuită pentru comenzile de peste 300 RON. Curier rapid disponibil."}),u.jsx("div",{className:"flex items-center space-x-4 mt-4 ml-2",children:u.jsx(Ie,{product:t})})]})]})]})},ai=()=>{const{favoriteItems:r,removeFromFavorites:e}=y.useContext(Ae),[t,s]=y.useState([]);y.useEffect(()=>{(async()=>{if(r.length===0){s([]);return}const{data:a,error:o}=await P.from("products").select("*").in("id",r.map(c=>c.product_id));if(o){console.error("Eroare la încărcarea produselor favorite:",o);return}s(a)})()},[r]);const n=async i=>{await e(i),s(a=>a.filter(o=>o.id!==i))};return u.jsx("div",{className:"flex justify-center",children:u.jsxs("div",{className:"w-full max-w-7xl p-2",children:[u.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Favoritele mele"}),u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-5",children:t.length>0?t.map(i=>u.jsxs("div",{className:`relative w-full aspect-w-1 aspect-h-1 border rounded-md p-4 \r
                shadow hover:shadow-lg transition-transform duration-200 flex flex-col \r
                items-center justify-between bg-gray-100 hover:scale-105`,children:[u.jsxs(Ee,{to:`/product/${i.id}`,className:"w-full h-full flex flex-col items-center justify-between",children:[u.jsx("div",{className:"w-full h-full flex justify-center items-center",children:u.jsx("img",{src:i.images[0],alt:i.title,className:"w-full h-full object-cover rounded-md"})}),u.jsx("h3",{className:"text-lg font-semibold mt-2 text-center",children:i.title}),u.jsx("p",{className:"text-sm text-gray-600 mt-1 text-center",children:i.description}),u.jsxs("p",{className:"text-base font-bold mt-2 text-center",children:[i.price," RON"]})]}),u.jsxs("div",{className:"absolute bottom-2 right-2 flex space-x-2 items-center sm:bottom-2 sm:right-2",children:[u.jsx(Ie,{product:i,showText:!1,onClick:()=>n(i.id)}),u.jsx(nt,{product:i,quantity:1,setQuantity:()=>{},showText:!1})]})]},i.id)):u.jsx("p",{className:"text-center col-span-full",children:"Nu ai produse favorite."})})]})})},oi=()=>{const{user:r}=y.useContext(ie),e=D(),t=()=>{r&&r.id&&e(`/user/${r.id}`)};return u.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-gray-100 rounded-lg shadow-md",children:[u.jsxs("div",{className:"mb-6",children:[u.jsxs("h1",{className:"text-2xl text-sky-900 font-bold",children:["Salut, ",r?r.first_name:"Utilizator","!"]}),u.jsx("p",{className:"text-sky-600",children:r?r.email:"Email indisponibil"})]}),u.jsx("div",{className:"mb-6",children:u.jsx("h2",{className:"text-xl cursor-pointer border p-4 rounded-lg shadow-md bg-white text-gray-600 hover:text-gray-600 hover:font-bold",onClick:t,children:"Datele mele"})}),u.jsx("div",{className:"mb-6 border p-4 shadow-md bg-white rounded-lg",children:u.jsx("h2",{className:"text-xl",children:"Adrese"})}),u.jsx("div",{className:"mb-6 border p-4 shadow-md bg-white rounded-lg",children:u.jsx("h2",{className:"text-xl",children:"Comenzi"})}),u.jsx("div",{className:"mb-6 border p-4 shadow-md bg-white rounded-lg",children:u.jsx("h2",{className:"text-xl",children:"Retururi"})})]})},ci=()=>{const[r,e]=y.useState({firstName:"Nume",lastName:"Prenume",birthDate:"1990-01-01",phoneNumber:"123-456-7890",email:"user@example.com",password:"********"}),[t,s]=y.useState({firstName:!1,lastName:!1,birthDate:!1,phoneNumber:!1,email:!1,password:!1}),[n,i]=y.useState({email:""}),a=D(),o=()=>{a(-1)},c=h=>{s(f=>({...f,[h]:!f[h]}))},l=h=>{const{name:f,value:m}=h.target;e(g=>({...g,[f]:m})),f==="email"&&d(m)},d=h=>{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h)?i(m=>({...m,email:""})):i(m=>({...m,email:"Formatul adresei de email este incorect"}))};return u.jsx("div",{className:"flex justify-center mt-6 p-3",children:u.jsxs("form",{className:"relative bg-white p-6 rounded shadow-md w-full max-w-2xl",children:[u.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800",onClick:o,children:"✕"}),u.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Datele Mele"}),Object.keys(r).map(h=>u.jsxs("div",{className:"mb-4 relative",children:[u.jsx("label",{htmlFor:h,className:"block text-gray-700",children:h.charAt(0).toUpperCase()+h.slice(1)}),t[h]?h==="birthDate"?u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"date",id:h,name:h,value:r[h],onChange:l,className:"w-full px-3 py-2 border rounded "}),u.jsx("button",{type:"button",onClick:()=>c(h),className:"ml-2 px-3 py-2 text-sky-600 hover:underline",children:"Confirmă"})]}):u.jsxs("div",{className:"relative",children:[u.jsx("input",{type:"text",id:h,name:h,value:r[h],onChange:l,className:"w-full px-3 py-2 border rounded"}),u.jsx("button",{type:"button",onClick:()=>c(h),className:"absolute inset-y-0 right-0 px-3 text-sky-600 hover:underline",children:"Confirmă"})]}):u.jsxs("div",{className:"relative flex items-center",children:[u.jsx("p",{className:"w-full px-3 py-2 border rounded bg-gray-100",children:r[h]}),u.jsx("button",{type:"button",onClick:()=>c(h),className:"absolute inset-y-0 right-0 px-3 text-sky-600 hover:underline",children:"Modifică"})]}),h==="email"&&n.email&&u.jsx("p",{className:"text-red-500 text-sm",children:n.email})]},h)),u.jsxs("div",{className:"flex justify-between",children:[u.jsx("button",{type:"button",onClick:o,className:"bg-sky-900 text-white py-2 px-4 rounded hover:bg-sky-800",children:"Anulează"}),u.jsx("button",{type:"button",onClick:o,className:"bg-sky-900 text-white py-2 px-4 rounded hover:bg-sky-800",children:"Salvează"})]})]})})},li=()=>{const[r,e]=y.useState(""),[t,s]=y.useState(""),[n,i]=y.useState(""),a=D(),{login:o}=y.useContext(ie);y.useEffect(()=>{const h=localStorage.getItem("email"),f=localStorage.getItem("password");h&&f&&(e(h),s(f),localStorage.removeItem("email"),localStorage.removeItem("password"))},[]);const c=async h=>{h.preventDefault();const{data:f,error:m}=await P.auth.signInWithPassword({email:r,password:t});m?i("Email sau parolă incorectă"):(o(f.user),a("/"))},l=()=>{a("/")},d=()=>{a("/register")};return u.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:u.jsxs("form",{onSubmit:c,className:"relative bg-white p-6 rounded shadow-md w-80",children:[u.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500 hover:text-gray-800",onClick:l,children:"✕"}),u.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Log In"}),n&&u.jsx("p",{className:"text-red-500 mb-4",children:n}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"email",className:"block text-gray-700",children:"Email"}),u.jsx("input",{type:"email",id:"email",name:"email",value:r,onChange:h=>e(h.target.value),className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"new-email"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"password",className:"block text-gray-700",children:"Password"}),u.jsx("input",{type:"password",id:"password",name:"password",value:t,onChange:h=>s(h.target.value),className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"new-password"})]}),u.jsx("button",{type:"submit",className:"w-full bg-sky-900 text-white py-2 duration-100 active:scale-105 hover:bg-sky-800 active:bg-sky-700 rounded mb-4",children:"Log In"}),u.jsx("button",{type:"button",onClick:d,className:"w-full bg-sky-600 text-white py-2 duration-100 active:scale-105 hover:bg-sky-500 active:bg-sky-400 rounded",children:"Sign Up"}),u.jsx("button",{type:"button",className:"w-full text-grey-200 py-2 duration-100 active:scale-105 hover:text-sky-800 active:text-sky-700 rounded",children:"Reset Password"})]})})},Xe=({element:r})=>{const{isAuthenticated:e}=y.useContext(ie);return e?r:u.jsx(js,{to:"/login"})};Xe.propTypes={element:E.element.isRequired};const ui=()=>{const[r,e]=y.useState(""),[t,s]=y.useState(""),[n,i]=y.useState(""),[a,o]=y.useState(""),[c,l]=y.useState(!1),[d,h]=y.useState(""),[f,m]=y.useState(!1),[g,_]=y.useState(""),[p,w]=y.useState(""),k=D();y.useEffect(()=>{e(""),s(""),i(""),o(""),m(!1)},[]);const x=j=>{const Y=j.target.value;o(Y),h(Y.length<6?"Parola slabă":Y.length<10?"Parola medie":"Parola puternică")},S=async j=>{j.preventDefault(),_(""),w(""),console.log("Attempting to register user...");const{data:Y,error:ae}=await P.auth.signUp({email:n,password:a});if(console.log("SignUp Response: ",Y,ae),ae||!Y.user){_((ae==null?void 0:ae.message)||"Înregistrarea a eșuat. Verifică datele și încearcă din nou.");return}w("Cont creat cu succes!"),e(""),s(""),i(""),o(""),m(!1),console.log("User created successfully!"),localStorage.setItem("email",n),localStorage.setItem("password",a),setTimeout(()=>{w(""),k("/login")},2e3)};return u.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:u.jsxs("form",{onSubmit:S,className:"relative bg-white p-6 rounded shadow-md w-96",children:[u.jsx("button",{type:"button",className:"absolute top-2 right-2 text-gray-500",onClick:()=>k("/login"),children:"✕"}),u.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Înregistrare"}),g&&u.jsx("p",{className:"text-red-500 bg-red-100 p-2 rounded mb-4",children:g}),p&&u.jsx("p",{className:"text-green-500 bg-green-100 p-2 rounded mb-4",children:p}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"firstName",className:"block text-gray-700",children:"Prenume"}),u.jsx("input",{id:"firstName",type:"text",value:r,onChange:j=>e(j.target.value),className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"off"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"lastName",className:"block text-gray-700",children:"Nume de familie"}),u.jsx("input",{id:"lastName",type:"text",value:t,onChange:j=>s(j.target.value),className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"off"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"email",className:"block text-gray-700",children:"E-mail"}),u.jsx("input",{id:"email",type:"email",value:n,onChange:j=>i(j.target.value),className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"off"})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("label",{htmlFor:"password",className:"block text-gray-700",children:"Parola"}),u.jsxs("div",{className:"relative",children:[u.jsx("input",{id:"password",type:c?"text":"password",value:a,onChange:x,className:"w-full px-3 py-2 border rounded",required:!0,autoComplete:"new-password"}),u.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 px-3 text-gray-600",onClick:()=>l(!c),children:c?"Ascunde":"Arată"})]}),u.jsx("p",{className:"text-sm mt-1",children:d})]}),u.jsx("div",{className:"mb-4",children:u.jsxs("label",{className:"inline-flex items-center",children:[u.jsx("input",{type:"checkbox",checked:f,onChange:j=>m(j.target.checked),className:"form-checkbox"}),u.jsx("span",{className:"ml-2",children:"Doresc să primesc informații despre noutăți, promoții și vouchere de reducere"})]})}),u.jsx("button",{type:"submit",className:"w-full bg-sky-900 text-white py-2 hover:bg-sky-800 active:bg-sky-700 rounded mb-4",children:"Înregistrare"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Declar că am luat la cunoștință de principiile prelucrării datelor și de termenii și condițiile."}),u.jsxs("p",{className:"text-sm text-gray-600 mt-4",children:["Aveți deja cont?"," ",u.jsx("button",{type:"button",className:"text-sky-600 hover:underline",onClick:()=>k("/login"),children:"Autentificare"})]})]})})};function di(){const[r,e]=y.useState("");return u.jsx("div",{className:"app-container",children:u.jsx(ds,{children:u.jsx(us,{children:u.jsx(hs,{children:u.jsx(ys,{children:u.jsx(ks,{basename:"/dan-store",children:u.jsx(Ss,{children:u.jsxs($,{path:"/",element:u.jsx(Zn,{searchTerm:r,setSearchTerm:e}),children:[u.jsx($,{index:!0,element:u.jsx(ei,{})}),u.jsx($,{path:"product-list",element:u.jsx(it,{searchTerm:r})}),u.jsx($,{path:"newproducts",element:u.jsx(ti,{})}),u.jsx($,{path:"cart",element:u.jsx(si,{})}),u.jsx($,{path:"promotions",element:u.jsx(ri,{})}),u.jsx($,{path:"product/:id",element:u.jsx(ii,{})}),u.jsx($,{path:"*",element:u.jsx(ni,{})}),u.jsx($,{path:"favorite",element:u.jsx(ai,{})}),u.jsx($,{path:"register",element:u.jsx(ui,{})}),u.jsx($,{path:"myaccount",element:u.jsx(Xe,{element:u.jsx(oi,{})})}),u.jsx($,{path:"user/:id",element:u.jsx(Xe,{element:u.jsx(ci,{})})}),u.jsx($,{path:"login",element:u.jsx(li,{})})]})})})})})})})})}Ts.createRoot(document.getElementById("root")).render(u.jsx(y.StrictMode,{children:u.jsx(di,{})}));
